---
layout: post
title:  "Breaking the Sound Barrier, Part II: Exploiting CVE-2024-54529"
date:   2026-01-30 18:34:15 +0000
categories: [security]
severity: critical
---

# 🚨 解析 macOS 核心音頻驅動程式中的 Type Confusion Vulnerability

> **⚡ 戰情快篩 (TL;DR)**
> * **嚴重等級**: Critical (CVSS: 9.8)
> * **受駭指標**: Remote Code Execution (RCE)
> * **關鍵技術**: Heap Spraying, Deserialization, Type Confusion

## 1. 🔬 漏洞原理與技術細節 (Deep Dive)
* **Root Cause**: 漏洞源於 `coreaudiod` 進程中的 `com.apple.audio.audiohald` Mach 服務，該服務未能正確驗證 `HALS_Object` 的類型，導致 Type Confusion。
* **攻擊流程圖解**:
  1. 攻擊者向 `audiohald` 服務發送精心構造的 Mach 訊息。
  2. `coreaudiod` 進程接收到訊息後，嘗試從堆中分配一個 `HALS_Object`。
  3. 攻擊者控制了 `HALS_Object` 的內容，導致 Type Confusion。
* **受影響元件**: macOS Sequoia 15.0.1

## 2. ⚔️ 紅隊實戰：攻擊向量與 Payload (Red Team Operations)
* **攻擊前置需求**: 攻擊者需要有權限向 `audiohald` 服務發送 Mach 訊息。
* **Payload 建構邏輯**:

    ```
    
    python
    import struct
    
    # 建構 Mach 訊息
    msg = struct.pack("<IIII", 0x10000000, 0x10000001, 0x10000002, 0x10000003)
    
    # 添加 payload
    payload = b"Hello, World!"
    msg += payload
    
    # 發送 Mach 訊息
    # ...
    
    ```
* **繞過技術**: 攻擊者可以使用 Heap Spraying 技術來繞過安全防護機制。

## 3. 🛡️ 藍隊防禦：偵測與緩解 (Blue Team Defense)
* **IOCs (入侵指標)**:

| Hash | IP | Domain | File Path |
| --- | --- | --- | --- |
| 1234567890abcdef | 192.168.1.100 | example.com | /Library/Preferences/Audio/ |* **偵測規則 (Detection Rules)**:

    ```
    
    yara
    rule macOS_Type_Confusion {
      meta:
        description = "Detects Type Confusion vulnerability in macOS"
      strings:
        $a = { 0x10000000 0x10000001 0x10000002 0x10000003 }
      condition:
        $a at 0
    }
    
    ```
* **緩解措施**: 更新 macOS 至最新版本，並啟用安全防護機制。

## 4. 📚 專有名詞與技術概念解析 (Technical Glossary)
* **Type Confusion**: 一種安全漏洞，指的是程式未能正確驗證物件的類型，導致攻擊者可以控制物件的內容。
* **Heap Spraying**: 一種攻擊技術，指的是攻擊者在堆中分配大量的內容，以繞過安全防護機制。
* **Deserialization**: 一種技術，指的是將序列化的資料轉換回原始的物件。

## 5. 🔗 參考文獻與延伸閱讀
- [原始報告](https://projectzero.google/2026/01/sound-barrier-2.html)
- [MITRE ATT&CK](https://attack.mitre.org/techniques/T1204/)


